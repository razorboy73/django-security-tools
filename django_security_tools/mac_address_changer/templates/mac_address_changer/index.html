<!DOCTYPE html>
<html>

<head>
    <title>MAC Address Changer</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>

<body>
    <h1>MAC Address Changer</h1>

    <!-- Button to Find Network Interfaces -->
    <button type="button" onclick="findInterfaces()">Find Network Interfaces</button>
    <!-- User Instructions -->
    <p id="instructions-container">Click the "Find Network Interfaces" button to find all the active network interfaces on your computer.</p>
    
    <!-- Placeholder to Display Found Interfaces -->
    <div id="interfaces-container">
        <!-- Dynamically populated by JavaScript -->
    </div>

    <!-- Form to Change MAC Address -->
    <form method="POST" action="{% url 'change_mac' %}">
        {% csrf_token %}
        <label for="interface">Selected Interface:</label>
        <input type="text" id="interface" name="interface" readonly placeholder="Select an interface above">
        <label for="mac">New MAC Address:</label>
        <input type="text" id="mac" name="mac">
        <button type="button" onclick="generateMac()">Generate MAC</button>
        <button type="submit">Change MAC</button>
    </form>

    <!-- Form to Revert MAC Address -->
    <form method="POST" action="{% url 'revert_mac' %}">
        {% csrf_token %}
        <label for="revert_interface">Revert Interface:</label>
        <input type="text" id="revert_interface" name="interface" readonly placeholder="Select an interface above">
        <button type="submit">Revert to Original MAC</button>
    </form>

    <!-- Container for Alerts and Messages -->
    <div id="message-container">
        {% for message in messages %}
        <div class="alert">{{ message }}</div>
        {% endfor %}
    </div>

    <script>
        // Function to Find Network Interfaces
        function findInterfaces() {
            fetch("{% url 'find_interfaces' %}")
                .then(response => response.json())
                .then(data => {
                    const instructionsContainer = document.getElementById('instructions-container');
                    const container = document.getElementById('interfaces-container');
                    instructionsContainer.innerHTML = data.instructions || ''; // Display instructions
                    container.innerHTML = ''; // Clear previous results

                    if (data.error) {
                        container.innerHTML = `<p class="error">${data.error}</p>`;
                    } else {
                        data.interfaces.forEach(item => {
                            const button = document.createElement('button');
                            button.innerText = `${item.name} - ${item.mac}`;
                            button.onclick = (e) => {
                                e.preventDefault();
                                selectInterface(item.name);
                            };
                            container.appendChild(button);
                        });
                    }
                })
                .catch(error => {
                    console.error('Error fetching interfaces:', error);
                });
        }

        // Function to Populate Selected Interface
        function selectInterface(interfaceName) {
            document.getElementById('interface').value = interfaceName;
               }

        // Function to Generate a Random MAC Address
        function generateMac() {
            fetch("{% url 'generate_mac' %}")
                .then(response => response.json())
                .then(data => document.getElementById('mac').value = data.mac_address)
                .catch(error => console.error('Error generating MAC:', error));
        }
    </script>
</body>

</html>